# 罗小黑战记小程序 - 购物功能说明

## 功能概述

为罗小黑战记小程序添加了完整的购物功能，包括：
- 商品展示
- 购物车管理
- 库存管理
- 云数据库支持

## 文件结构

```
pages/shop/
├── shop.js          # 购物页面逻辑
├── shop.wxml        # 购物页面模板
├── shop.wxss        # 购物页面样式
└── shop.json        # 购物页面配置

utils/
├── cloud.js         # 云数据库工具类
└── initCloudData.js # 云数据库初始化脚本
```

## 云数据库配置

### 1. 启用云开发

1. 在微信开发者工具中，点击"云开发"
2. 开通云开发服务
3. 创建云环境
4. 获取环境ID

### 2. 配置环境ID

在 `app.js` 中替换环境ID：

```javascript
wx.cloud.init({
  env: 'your-cloud-env-id', // 替换为你的云环境ID
  traceUser: true
})
```

### 3. 创建数据库集合

在云开发控制台中创建以下集合：

#### products 集合（商品表）
```javascript
{
  _id: "自动生成",
  name: "商品名称",
  price: 10,           // 价格（数字）
  model: "型号",
  stock: 10,           // 库存数量
  image: "图片URL",
  description: "商品描述",
  category: "分类",
  status: "active"     // 状态：active/inactive
}
```

#### cart 集合（购物车表）
```javascript
{
  _id: "自动生成",
  userId: "用户ID",
  items: [],           // 购物车商品数组
  createTime: "创建时间",
  updateTime: "更新时间"
}
```

#### orders 集合（订单表）
```javascript
{
  _id: "自动生成",
  userId: "用户ID",
  items: [],           // 订单商品数组
  totalPrice: 100,     // 总价
  status: "pending",   // 订单状态
  createTime: "创建时间"
}
```

### 4. 一键初始化（推荐）

**最简单的方法：**

1. 在微信开发者工具中编译小程序
2. 进入购物页面
3. 点击右上角购物车图标
4. 点击 **"🚀 一键初始化云数据库"** 按钮
5. 等待初始化完成！

**或者手动调用：**

```javascript
const autoInit = require('./utils/autoInitCloud.js')

// 一键初始化所有集合和数据
autoInit.oneClickInit()
```

## 功能特性

### 商品管理
- 支持从云数据库或本地数据加载商品
- 实时库存管理
- 商品详情查看

### 购物车功能
- 添加/移除商品
- 数量调整
- 总价计算
- 本地存储同步

### 用户体验
- 加载状态提示
- 库存不足提醒
- 购物车数量徽章
- 响应式设计

## 使用方法

### 1. 首页入口
在首页的关系网和剧集介绍按钮下方，添加了购物入口按钮，点击即可进入购物页面。

### 2. 购物流程
1. 浏览商品列表
2. 点击商品查看详情
3. 添加到购物车
4. 调整商品数量
5. 结算购买

### 3. 购物车管理
- 点击右上角购物车图标打开购物车
- 在购物车中调整商品数量
- 移除不需要的商品
- 清空整个购物车

## 注意事项

1. **云数据库配置**：确保正确配置云环境ID
2. **权限设置**：在云开发控制台中设置数据库权限
3. **网络环境**：确保网络连接正常
4. **数据同步**：购物车数据会同时保存到本地存储和云数据库

## 扩展功能

可以进一步扩展的功能：
- 用户登录系统
- 订单历史记录
- 支付集成
- 商品搜索和筛选
- 商品评价系统
- 优惠券功能

## 技术支持

如有问题，请检查：
1. 云开发环境是否正确配置
2. 数据库集合是否创建
3. 网络连接是否正常
4. 控制台是否有错误信息
