<!--pages/share/publish/publish.wxml-->
<view class="container">

  <!-- 发布表单 -->
  <view class="publish-form">
    <!-- 用户信息 -->
    <view class="user-section">
      <image class="user-avatar" src="{{userInfo.avatarUrl || 'Sucai/person/MainShow/xiaohei1.png'}}" mode="aspectFill"></image>
      <text class="user-name">{{userInfo.nickName || '匿名用户'}}</text>
    </view>

    <!-- 内容输入 -->
    <view class="content-section">
      <textarea 
        class="content-input" 
        placeholder="分享你的想法..." 
        value="{{content}}"
        bindinput="onContentInput"
        maxlength="500"
        show-confirm-bar="{{false}}"
        auto-height
      ></textarea>
      <view class="char-count">{{content.length}}/500</view>
    </view>

    <!-- 图片上传 -->
    <view class="images-section">
      <view class="section-title">添加图片</view>
      <view class="images-container">
        <view 
          wx:for="{{images}}" 
          wx:key="*this" 
          wx:for-item="image"
          class="image-item"
        >
          <image 
            class="uploaded-image" 
            src="{{image}}" 
            mode="aspectFill"
            bindtap="previewImage"
            data-src="{{image}}"
          ></image>
          <view class="image-delete" bindtap="deleteImage" data-index="{{index}}">
            <text class="delete-icon">×</text>
          </view>
        </view>
        
        <view 
          wx:if="{{images.length < 9}}" 
          class="upload-btn" 
          bindtap="chooseImage"
        >
          <text class="upload-icon">📷</text>
          <text class="upload-text">添加图片</text>
        </view>
      </view>
      
      <!-- 阿里云链接输入 -->
      <view class="url-input-section">
        <view class="section-title">或输入阿里云图片链接</view>
        <view class="url-input-container">
          <input 
            class="url-input" 
            placeholder="输入阿里云OSS图片链接" 
            value="{{imageUrl}}"
            bindinput="onUrlInput"
            confirm-type="done"
          />
          <button class="add-url-btn" bindtap="addImageFromUrl">添加</button>
        </view>
      </view>
    </view>

    <!-- 标签输入 -->
    <view class="tags-section">
      <view class="section-title">添加标签</view>
      <view class="tags-input-container">
        <input 
          class="tags-input" 
          placeholder="输入标签，用空格分隔" 
          value="{{tagInput}}"
          bindinput="onTagInput"
          bindconfirm="addTag"
          confirm-type="done"
        />
        <button class="add-tag-btn" bindtap="addTag">添加</button>
      </view>
      <view class="tags-display" wx:if="{{tags.length > 0}}">
        <view 
          wx:for="{{tags}}" 
          wx:key="*this" 
          wx:for-item="tag"
          class="tag-item"
        >
          <text class="tag-text">#{{tag}}</text>
          <text class="tag-remove" bindtap="removeTag" data-tag="{{tag}}">×</text>
        </view>
      </view>
    </view>

    <!-- 发布按钮 -->
    <view class="publish-actions">
      <button 
        class="publish-submit-btn btn btn-primary" 
        bindtap="publishShare"
        disabled="{{!canPublish}}"
      >
        <text wx:if="{{publishing}}">发布中...</text>
        <text wx:else>发布</text>
      </button>
    </view>
  </view>
</view>
