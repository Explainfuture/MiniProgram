<!--pages/shop/shop.wxml-->
<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">ğŸ›ï¸ ç½—å°é»‘å‘¨è¾¹å•†åº—</text>
    <text class="page-subtitle">ç²¾é€‰å¥½ç‰©ï¼Œç­‰ä½ æ¥è´­</text>
  </view>


  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <text class="loading-text">æ­£åœ¨åŠ è½½å•†å“...</text>
  </view>

  <!-- å•†å“åˆ—è¡¨ -->
  <view class="products-container" wx:else>
    <view class="product-card" wx:for="{{products}}" wx:key="_id" bindtap="viewProductDetail" data-id="{{item._id}}">
      <view class="product-image-container">
        <image class="product-image" src="{{item.image}}" mode="aspectFill"></image>
        <view class="stock-badge" wx:if="{{item.stock <= 5}}">ä»…å‰©{{item.stock}}ä»¶</view>
      </view>
      
      <view class="product-info">
        <view class="product-name">{{item.name}}</view>
        <view class="product-model">{{item.model}}</view>
        <view class="product-price">Â¥{{item.price}}</view>
        <view class="product-stock">åº“å­˜ï¼š{{item.stock}}ä»¶</view>
      </view>
      
      <button class="add-to-cart-btn" 
              bindtap="addToCart" 
              data-id="{{item._id}}"
              disabled="{{item.stock <= 0}}">
        {{item.stock <= 0 ? 'ç¼ºè´§' : 'åŠ å…¥è´­ç‰©è½¦'}}
      </button>
    </view>
  </view>

  <!-- è´­ç‰©è½¦å¼¹çª— -->
  <view class="cart-modal {{showCart ? 'show' : ''}}" bindtap="toggleCart">
    <view class="cart-content" catchtap="true">
      <view class="cart-header">
        <text class="cart-title">è´­ç‰©è½¦</text>
        <button class="clear-cart-btn" bindtap="clearCart" wx:if="{{cart.length > 0}}">æ¸…ç©º</button>
      </view>
      
      <view class="cart-items" wx:if="{{cart.length > 0}}">
        <view class="cart-item" wx:for="{{cart}}" wx:key="_id">
          <image class="cart-item-image" src="{{item.image}}" mode="aspectFill"></image>
          
          <view class="cart-item-info">
            <view class="cart-item-name">{{item.name}}</view>
            <view class="cart-item-model">{{item.model}}</view>
            <view class="cart-item-price">Â¥{{item.price}}</view>
          </view>
          
          <view class="cart-item-controls">
            <button class="quantity-btn" bindtap="updateQuantity" data-id="{{item._id}}" data-type="decrease">-</button>
            <text class="quantity">{{item.quantity}}</text>
            <button class="quantity-btn" bindtap="updateQuantity" data-id="{{item._id}}" data-type="increase">+</button>
          </view>
          
          <button class="remove-btn" bindtap="removeFromCart" data-id="{{item._id}}">Ã—</button>
        </view>
      </view>
      
      <view class="cart-empty" wx:else>
        <text class="empty-text">è´­ç‰©è½¦ç©ºç©ºå¦‚ä¹Ÿ~</text>
        <text class="empty-hint">å¿«å»é€‰è´­å¿ƒä»ªçš„å•†å“å§</text>
      </view>
      
      <view class="cart-footer" wx:if="{{cart.length > 0}}">
        <view class="total-price">
          <text class="total-label">æ€»è®¡ï¼š</text>
          <text class="total-amount">Â¥{{totalPrice}}</text>
        </view>
        <button class="checkout-btn" bindtap="checkout">ç«‹å³ç»“ç®—</button>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨è´­ç‰©è½¦æ  -->
  <view class="bottom-cart-bar" wx:if="{{cart.length > 0}}">
    <view class="cart-info" bindtap="toggleCart">
      <view class="cart-icon-bottom">
        <text class="icon">ğŸ›’</text>
        <text class="cart-count-bottom" wx:if="{{cart.length > 0}}">{{cart.length}}</text>
      </view>
      <view class="cart-text">
        <text class="cart-title">è´­ç‰©è½¦</text>
        <text class="cart-subtitle">{{cart.length}}ä»¶å•†å“</text>
      </view>
    </view>
    <text class="cart-price">Â¥{{totalPrice}}</text>
    <button class="checkout-btn-bottom" bindtap="checkout">ç»“ç®—</button>
  </view>
</view>
